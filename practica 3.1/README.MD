# Практика HDFS

1. Практика посвящена работе с Hadoop, и нам, по классике, хотелось бы установить себе Hadoop локально. Однако устанавливать Hadoop локально в свою ОС не самое лучшее решение(хотя вполне рабочее), т.к. основным компонентом Hadoop является HDFS – т.е. целая файловая система и соседство двух ФС на одном рабочем ноутбуке может привести к множеству проблем. Поэтому мы рекомендуем 2 решения – установка экосистемы Hadoop на виртуальную машину или установка через Docker. Безусловно есть возможность познакомиться с экосистемой Hadoop воспользовавшись услугами облачных провайдеров, но у данного решения тоже есть свои издержки, в первую очередь - финансовые.

    1. В данном примере мы покажем как устанавливать экосистему Hadoop с помощью виртуальной машины. Поэтому нам в первую очередь нужна сама виртуальная машина, самое популярное решение на рынке – это VirtualBox. Скачайте VirtualBox с оф. сайта https://www.virtualbox.org/wiki/Downloads и установите на ваш ПК.

    1. Далее нам необходимо скачать официальную сборку Cloudera(один из крупнейших поставщиков решений в экосистеме Hadoop) - https://downloads.cloudera.com/demo_vm/virtualbox/cloudera-quickstart-vm-5.13.0-0-virtualbox.zip

    1. После скачивания и установки VirtualBox вам необходимо импортировать сборку Cloudera в VirtualBox и выполнить запуск. Перед запуском желательно выделить немного больше ресурсов для виртуальной машины. В идеале – 8 гб оперативки и 2 ядра процессора. После запуска виртуальной машины у вас должно получится следующее

    1. Если вы видите данную картину, значит установка экосистемы Hadoop в виртуальной машине прошла успешно. Поздравляем! Теперь вам доступны для использования HDFS, Hive, Spark и прочее. В первую очередь рекомендуем ознакомиться с HUE – программным обеспечением, которое дает возможность взаимодействовать с экосистемой Hadoop с помощью пользовательского интерфейса.

    1. Для авторизации в HUE используйте следующее сочетание логина и пароля по умолчанию:  cloudera/cloudera.


    1. После авторизации в HUE с помощью иконки меню в левом верхнем углу 
    
    1. Выберите раздел Files

        **Поздравляем – вы только что попали в файловую систему HDFS, а конкретно в home-папку вашего пользователя. Пока в ней пусто, но это ненадолго.** 

    1. Теперь нам необходимо активировать возможность обмениваться файлами между вашей локальной ОС и виртуальной гостевой ОС. Для этого активируйте подключение образа диска гостевой ОС. 
    
        Теперь перейдите в Computer и убедитесь, что у вас появился образ диска

        Переходите внутрь и выполните autorun.sh

        После выполнения autorun.sh – перезапустите вашу виртуальную машину.

    1. Теперь вам доступна функция drag&drop и вы можете с помощью курсора мыши перетаскивать файлы из вашей локальной ОС в вашу виртуальную ОС. Переходим на сайт https://all-the-books.ru/authors/tolstoy-lev-nikolaevich/ и скачиваем все тома произведения «Война и мир» в формате txt.

    1. Далее перетаскиваем эти файлы в любое место на вашей виртуальной машине.

    1. Теперь мы приступаем к изучению базовых команд работы с файловой системой HDFS. Для взаимодействия с HDFS мы будем использовать терминал. Ознакомиться со списком базовых команд hdfs можно в официальной документации: https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/FileSystemShell.html#du

    1. Запускаем терминал
        
        И выполняем следующие действия
        
        * Когда мы перетащили файлы с произведением Льва Толстого – мы перетащили их в файловую систему виртуальной машины, но не в HDFS, соответственно, в первую очередь нам нужно перенести их в папку нашего пользователя именно на HDFS.
        
        * После того, как файлы окажутся на HDFS попробуйте выполнить команду, которая выводит содержимое папки. Особенно обратите внимание на права доступа к вашим файлам.
        
        * Далее сожмите все 4 тома в 1 файл.
        
        * Теперь давайте изменим права доступа к нашему файлу. Чтобы с нашим файлом могли взаимодействовать коллеги, установите режим доступа, который дает полный доступ для владельца файла, а для сторонних пользователей возможность читать и выполнять.
        
        * Попробуйте заново использовать команду для вывода содержимого папки и обратите внимание как изменились права доступа к файлу.

        * Теперь попробуем вывести на экран информацию о том, сколько места на диске занимает наш файл. Желательно, чтобы размер файла был удобночитаемым.
        
        * На экране вы можете заметить 2 числа. Первое число – это фактический размер файла, а второе – это занимаемое файлом место на диске с учетом репликации. По умолчанию в данной версии HDFS эти числа будут одинаковы – это означает, что никакой репликации нет – нас это не очень устраивает, мы хотели бы, чтобы у наших файлов существовали резервные копии, поэтому напишите команду, которая изменит фактор репликации на 2.
        
        * Повторите команду, которая выводит информацию о том, какое место на диске занимает файл и убедитесь, что изменения произошли.

        * Напишите команду, которая подсчитывает количество строк в вашем файле 
        
        * В качестве результатов вашей работы, запишите ваши команды и вывод этих команд в отдельный файл и выложите его на github.

## Дополнительные ссылки:
* Видеоинструкция по установке cloudera на VirtualBox: https://www.youtube.com/watch?v=8rsNXdvFqBc
* Docker-образ экосистемы Hadoop: https://github.com/big-data-europe/docker-hadoop-spark-workbench

## Файл с командами [file_command](/practica%203.1/commands.md)